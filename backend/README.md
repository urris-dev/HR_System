# Документация серверной части

## Архитектура

**Пакет** – папка, содержащая несколько логически связанных модулей. 

Архитектура серверной части состоит из:
* `users/` – пакета, относящегося к разделу **Пользователи**;
* `req/` – пакета, относящегося к разделу **Заявки**;
* `dismissals/` – пакета, относящегося к разделу **Увольнения**;
* `factories/` – пакета, относящегося к разделу **Заводы**;

Каждый из пакетов имеет следующую структуру:
* `api.py` – модуль, отвечающий за маршрутизацию запросов;
* `models.py` – модуль, определяющий таблицы базы данных;
* `schemas.py` – модуль, определяющий модели валидации и сериализации данных, приходящих в запросе на какой-либо маршрут;
* `services.py` – модуль, отвечающий за бизнес-логику;

Также серверная часть имеет глобальные модули:
* `oauth2.py` – содержит настройки JSON Web Token, используемого для аутентификации;
* `dependencies.py` – содержит функции проверки наличия токенов перед предоставлением доступа к API сервера;
* `database.py` – содержит настройки подключения к базе данных;
* `config.py` – содержит модель, сериализующую статические переменные окружения из файла `.env`;
* `main.py` – главный модуль серверной части, содержащий pre-инициализацию базы  данных, настройки подключения к API и привязку пакетов к маршрутам;

## Развёртывание
### Предварительные настройки
* Наличие PostgreSQL 17+
* Наличие Python 3.12+
### Запуск
1. Активировать виртуальное окружение:
```bash
cd ./backend
python3 -m venv .venv
source .venv/bin/activate
```
2. Установить зависимости проекта:
```bash
pip install -r requirements.txt
```
3. Определить переменные окружения **(изменить значения в <> на свои)**:
```bash
export DB_PATH=postgresql://<user>:<password>@<hostname>:<port>/<database>
export CLIENT_ORIGIN=$(hostname -I | cut -d ' ' -f 1)
```
4. Сгенерировать миграции базы данных:
```bash
cd ./migrations
mkdir versions
cd ..
alembic revision --autogenerate -m 'db_migrations' 
alembic upgrade head
```
5. Исправить неверную конфигурацию библиотеки:
```bash
sed -i 's/Sequence/List/g' ./.venv/lib/python3.12/site-packages/fastapi_jwt_auth/config.py
```
6. Запустить сервер:
```bash
uvicorn --host 0.0.0.0 --port 8000 main:app
```
7. Перейти по адресу http://0.0.0.0:8000/docs для проверки работоспособности.
